"use strict";!function(){$(function(){$.each($(".site__menu"),function(){new e($(this))}),$.each($(".full-height"),function(){new t($(this))}),$.each($(".site_ajax"),function(){new n($(this))})});var t=function(t){var e=this,n=t,i=$(window),o=function(){i.on({resize:function(){a()}})},s=function(){n[0].obj=e,o(),a()},a=function(){i.height()>=550?n.css({"min-height":i.height()}):n.css({"min-height":"550px"})};s(),e.setHeight=function(){a()}},e=function(t){var e=this,n=t,i=$("body"),o=n.find(".site__menu-btn"),s=n.find(".site__menu-link"),a=function(){o.on({click:function(){c($(this))}}),s.on({click:function(){l()}})},u=function(){n[0].obj=e,a()},c=function(t){var e=t;e.hasClass("opened")?e.removeClass("opened"):e.addClass("opened")},l=function(){o.removeClass("opened")};u(),e.addEvents=function(){i.find(".site__menu-btn").on(),i.find(".site__menu-link").on()}},n=function(n){var i,o=this,s=n,a=$(window),u=new XMLHttpRequest,c=null,l=!0,r=!1,f=null,_=500,d=$("html, body"),h=$(".site__layout"),m=h.data("scroll"),v=$("body"),g=$(".site__loading"),p=function(){$("body").on("click",".site__down-link",function(){return l&&S($(this),$(this).parents(".site__layout")),!1}),s.on("click",".site__menu-nav_ajax .site__menu-link",function(){return l&&S($(this),$("body").find(".site__layout")),!1}),window.addEventListener("popstate",function(t){var e=c;if(null==t.state){f=$(".site__layout");var n=$(JSON.parse(sessionStorage.getItem("index")).content);n.addClass("site__content_absolute"),g.addClass("show"),setTimeout(function(){w(n)},200)}else c="php/"+t.state.foo+".php",e!=c&&(f=$(".site__layout"),y())},!1),a.on({resize:function(){C(v.find(".site__layout"))},scroll:function(){C(v.find(".site__layout"))},DOMMouseScroll:function(t){var e=t.originalEvent.detail;if(e){var n=e>0?1:-1;T(n)}},mousewheel:function(t){var e=t.originalEvent.wheelDelta;if(e){var n=e>0?-1:1;T(n)}},touchmove:function(t){var e=t.originalEvent.touches[0].clientY;e>i?T(-1):i>e&&T(1),i=e}})},w=function(n){m=n.data("scroll"),f.addClass("site__content_top"),s.append(n),n.addClass("site__content_from-bottom"),setTimeout(function(){n.removeClass("site__content_from-bottom"),n.removeClass("site__content_absolute"),d.stop(!0,!1),d.animate({scrollTop:0},300),new t(n.find(".full-height")).setHeight(),g.removeClass("show")},500),setTimeout(function(){l=!0,C(v.find(".site__layout"))},1e3),setTimeout(function(){f.remove(),new e(n.find(".site__menu")).addEvents()},_)},y=function(){var t,e,n="sessionStorage"in window&&window.sessionStorage,i=/[^\/]*$/.exec(c)[0],o=i.split("."),s=o[0],a=!1;try{n&&(a=sessionStorage.getItem(s),a&&(a=JSON.parse(a),t=new Date,e=new Date(a.timestamp),e.setMinutes(e.getMinutes()+10),t.getTime()>e.getTime()&&(a=!1,sessionStorage.removeItem(s))))}catch(l){a=!1}if(a){var r=$(a.content);r.addClass("site__content_absolute"),g.addClass("show"),setTimeout(function(){w(r)},200)}else u.abort(),u=$.ajax({url:c,dataType:"html",timeout:2e4,type:"GET",success:function(t){if(n)try{sessionStorage.setItem(s,JSON.stringify({timestamp:new Date,content:t}))}catch(e){}var i=$(t);i.addClass("site__content_absolute"),g.addClass("show"),setTimeout(function(){w(i)},200)},error:function(t){"abort"!=t.statusText&&alert("Error!")}});return!1},b=function(){r=a.height()>=h.innerHeight()&&!(0==m)},C=function(t){r=a.scrollTop()+a.height()>=t.innerHeight()&&!(0==m)},S=function(t,e){l=!1,r=!1,c=t.data("href"),f=e,y();var n=/[^\/]*$/.exec(c)[0],i=n.split(".");n=i[0],history.pushState({foo:n},null,n+".html")},T=function(t){t>0&&r&&S(v.find(".site__layout"),v.find(".site__layout"))},x=function(){sessionStorage.setItem("index",JSON.stringify({timestamp:new Date,content:s.html()}))},k=function(){s[0].obj=o,p(),b(),x()};k()}}();
!function(){$(function(){$(".popup").each(function(){new Popup($(this))})})}();var Popup=function(o){var n=this,t=40,i=$(".popup__open"),p=o,e=p.find(".popup__lightbox"),c=p.find(".popup__close, .popup__cancel"),u=p.find(".popup__wrap"),s=p.find(".popup__content"),a=$("html"),d=$(window),r=setTimeout(function(){},1),f=function(){d.height()-2*t-u.height()>0?u.css({top:(d.height()-2*t-u.height())/2}):u.css({top:0})},h=function(){var o,n=document.createElement("div");return n.className="popup__scrollbar-measure",document.body.appendChild(n),o=n.offsetWidth-n.clientWidth,document.body.removeChild(n),o},l=function(){p.css({overflowY:"hidden"}),a.css({overflowY:"auto",paddingRight:0}),p.removeClass("popup_opened"),p.addClass("popup_hide"),r=setTimeout(function(){p.css({overflowY:"auto"}),p.removeClass("popup_hide")},300)},g=function(){p[0].obj=n,_()},_=function(){d.on({resize:function(){f()}}),i.on({click:function(){if(m($(this).attr("data-popup")),"lightbox"==$(this).attr("data-popup")){var o=$(this).parent(),n=o.css("background-image");e.css({"background-image":n})}return!1}}),u.on({click:function(o){o.stopPropagation()}}),p.on({click:function(){return l(),!1}}),c.on({click:function(){return l(),!1}})},m=function(o){v(o),a.css({overflowY:"hidden",paddingRight:h()}),p.addClass("popup_opened"),f()},v=function(o){var n=s.filter(".popup__"+o);s.css({display:"none"}),n.css({display:"block"})};n.show=function(o){o.on({click:function(){if(m($(this).attr("data-popup")),"lightbox"==$(this).attr("data-popup")){var o=$(this).parent(),n=o.css("background-image");e.css({"background-image":n})}return!1}})},g()};